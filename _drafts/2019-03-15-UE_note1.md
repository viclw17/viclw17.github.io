---
title: Exploring Interaction Effect in VR
date: 2019-03-15
tags:
- Unreal Engine
- Shader
---
In VR development, because the motion of the first person character is precisely mapping the real players' body(mainly hands) movement, the environment collision will never be able to prevent the player model from intersecting with the surrounding meshed. This is a well-accepted limitation of VR technique, however I personally feel it is a bit annoying if there is nothing done visually to address this fact.

During my current VR project, I was trying to create an effect to "soften out" the harsh clipping when players interact with the environment. This problem has been well addressed by [this amazing post](http://blog.leapmotion.com/interaction-sprint-exploring-the-hand-object-boundary/).

<img src="http://blog.leapmotion.com/wp-content/uploads/2017/12/standard-clipping.gif" width="480" style="display:block; margin:auto;">
<figcaption style="text-align: center;">Image from - <a href="http://blog.leapmotion.com/interaction-sprint-exploring-the-hand-object-boundary">blog.leapmotion.com</a></figcaption>
<br>

The post provides several solutions to this issue and are all
very practical and effective:

1. Use Depth Expressions to highlight the intersection;
2. Use texture mask to highlight the finger tips;
3. Add responsive meshes at the intersecting points.

Here in the post I want to cover more details about the implementation and troubleshooting of the first 2 solutions.

# Highlight the Intersection with Depth Expressions
<!-- <img src="http://blog.leapmotion.com/wp-content/uploads/2017/12/intersection-shader.gif" width="480" style="display:block; margin:auto;">
<figcaption style="text-align: center;">Image from - <a href="http://blog.leapmotion.com/interaction-sprint-exploring-the-hand-object-boundary">blog.leapmotion.com</a></figcaption> -->

## Unreal Depth Expressions
Unreal's [depth expressions](https://docs.unrealengine.com/en-us/Engine/Rendering/Materials/ExpressionReference/Depth) are extremely simple to use yet very versatile on creating effects like intersection highlight, enegery field/shield, scanning field etc.

<img src="{{ site.url }}/images/Work/depth_expression.jpg" width="480" style="display:block; margin:auto;">

### Pixel Depth
The PixelDepth expression outputs the **distance** from the camera to the pixels currently being rendered.

The values it return are very big and not normalized, so if you plug it into color output the result will be all blown out. You have to devide it with a big number and clamp it to get a proper look.

<img src="{{ site.url }}/images/Work/depth_pixel1.gif" width="480" style="display:block; margin:auto;">
<figcaption style="text-align: center;">Output as color.</figcaption>
<br>
<img src="{{ site.url }}/images/Work/depth_pixel2.gif" width="480" style="display:block; margin:auto;">
<figcaption style="text-align: center;">Use to drive opacity.</figcaption>
<br>

### Scene Depth
The SceneDepth expression outputs the existing scene depth. This is similar to PixelDepth, except that PixelDepth can sample the depth only at the pixel currently being rendered, whereas SceneDepth can sample depth **at any location**.

If an object has material outputing SceneDepth as color (after scaling and clamping), because of this feature, the output can show the objects that occluded. Also because it's accessing the scene depth, the material using this expression should use translucent as its blend mode to avoid itself writing the depth buffer.

> Only translucent materials may utilize SceneDepth!

<img src="{{ site.url }}/images/Work/depth_visualization2.gif" width="480" style="display:block; margin:auto;">
<figcaption style="text-align: center;">Sphere in the front assigned with material that outputs scene depth as color; sphere in the upper back is in translucent blend mode, which is not written into scene depth.</figcaption>
<br>

### Depth Fade
Depth Fade is a packed-up node used to fade a transparent object according to scene depth pass, to soften the seam where it intersects with opaque object.

<img src="{{ site.url }}/images/Work/depth_fade1.gif" width="480" style="display:block; margin:auto;">
<figcaption style="text-align: center;">Output as color.</figcaption>
<br>
<img src="{{ site.url }}/images/Work/depth_fade2.gif" width="480" style="display:block; margin:auto;">
<figcaption style="text-align: center;">Use to drive opacity.</figcaption>
<br>
<img src="{{ site.url }}/images/Work/depth_fade3.gif" width="480" style="display:block; margin:auto;">
<figcaption style="text-align: center;">Use to highlight the geometry intersection. (can also make it two-sided for better effect.)</figcaption>
<br>

Combined with other tricks, this node can help to achieve all sorts of cool FX like energy fence/shield etc.

<img src="{{ site.url }}/images/Work/depth_fade_fx.jpg" width="480" style="display:block; margin:auto;">
<br>
<img src="{{ site.url }}/images/Work/depth_fade4.gif" width="480" style="display:block; margin:auto;">
<figcaption style="text-align: center;">Add tiling noise to the intersection.</figcaption>
<br>

<!-- <img src="https://i.ytimg.com/vi/Dw8v4UYZcjA/maxresdefault.jpg" width="480" style="display:block; margin:auto;">
<br>
<figcaption style="text-align: center;">Image from - <a href="https://www.corbuzier.tk/2017/11/ue4-holo-shield-makingof/kG6Xt1NDgMi.html">Source</a></figcaption>
<br> -->
